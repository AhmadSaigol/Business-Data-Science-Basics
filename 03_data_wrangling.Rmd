---
title: "03 Data Wrangling"
date: "2021-04"
output:
  html_document:
    toc: true
    toc_float: true
    df_print: paged
    collapsed: false
    number_sections: true
    toc_depth: 3
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(message=FALSE,warning=FALSE, cache=TRUE)
```
# Patent Data Analysis using Reduced Dataset
## Libraries
```{r}
library(vroom)
library(data.table)
library(tidyverse)
```

## Loading Data

### Patent
Data concerning granted patents
```{r}
col_types_patent <- list(
  id = col_character(),
  date = col_date("%Y-%m-%d"),
  num_claims = col_double()
  
)

patent_tbl <- vroom(
            file       = "00_data/03_data/Patent_data_reduced/patent.tsv", 
            delim      = "\t", 
            col_types  = col_types_patent,
            na         = c("", "NA", "NULL")
        )

setDT(patent_tbl)

patent_tbl %>% head(n=10)
```

#### Description of columns:

* **id**: patent this record corresponds to


* **date**: date when patent was granted


* **num_claims**: number of claims

### Patent Assignee
Crosswalk between patent and assignee tables

```{r}
col_types_patent_assi <- list(
  patent_id =col_character(),
  assignee_id =  col_character()
)

patent_assignee_tbl <-  vroom(
            file       = "00_data/03_data/Patent_data_reduced/patent_assignee.tsv", 
            delim      = "\t", 
            col_types  = col_types_patent_assi,
            na         = c("", "NA", "NULL")
        )
setDT(patent_assignee_tbl)

patent_assignee_tbl %>% head(n=10)
```
#### Description of columns:

* **patent_id**: patent number


* **assignee_id**: unique assignee id generated by disambiguation algorithm

### Assignee
Disambiguated assignee data

```{r}
col_types_assi <- list(
  id = col_character(),
  type = col_integer(),
  organization =col_character()
)

assignee_tbl <-  vroom(
            file       = "00_data/03_data/Patent_data_reduced/assignee.tsv", 
            delim      = "\t", 
            col_types  = col_types_assi,
            na         = c("", "NA", "NULL")
        )
setDT(assignee_tbl)

assignee_tbl %>%  head(n=10)
```
#### Description of columns:

* **id**: unique assignee ID generated by the disambiguation algorithm


* **type**: classification of assignee 
  +   1 - Unassigned
  +   2 - US Company or Corporation
  +   3 - Foreign Company or Corporation
  +   4 - US Individual
  +   5 - Foreign Individual
  +   6 - US  Federal Government
  +   7 - Foreign Government
  +   8 - US County Government
  +   9 - US State Government. 

* **organization**: organization name if assignee is organization

### USPC
USPTO patent classification at patent issue date

```{r}
col_types_uspc <- list(
  patent_id = col_character(),
  mainclass_id = col_character(),
  sequence =col_integer()
)

uspc_tbl <-  vroom(
            file       = "00_data/03_data/Patent_data_reduced/uspc.tsv", 
            delim      = "\t", 
            col_types  = col_types_uspc,
            na         = c("", "NA", "NULL")
        )

setDT(uspc_tbl)

uspc_tbl %>% head(n=10)
```
#### Description of columns:

* **patent_id**: patent number


* **mainclass_id**: uspc mainclass at issue


* **sequence**: order in which uspc class appears in patent file


## Patent Dominance
What US company / corporation has the most patents? List the 10 US companies with the most assigned/granted patents.

```{r}
combined_data_for_q1 <- merge(x = assignee_tbl, y = patent_assignee_tbl, 
                       by.x = c("id"), by.y = c("assignee_id"))

combined_data_for_q1 [type == 2, .(number_of_patents=.N), by=organization][order(number_of_patents, decreasing=TRUE)] %>% 
  head(n=10)


```

## Recent patent activity
What US company had the most patents granted in August 2014? List the top 10 companies with the most new granted patents for August 2014.

### Most Number of patents granted in August 2014 to a US company
```{r}
combined_data_for_q2 <- merge(x=combined_data_for_q1, y=patent_tbl, by.x = c("patent_id"), by.y = c("id"))

combined_data_for_q2 <- combined_data_for_q2 %>%
  separate(col= "date", into= c("year", "month", "day"), sep = "-")

combined_data_for_q2[type == 2 & month == "08",  .(number_of_patents=.N), by=organization][order(number_of_patents, decreasing=TRUE)] %>%
  head(n=10)
```

### Top 10 companies with the most new granted patents for August 2014

```{r}
combined_data_for_q2[month == "08", .(number_of_patents=.N), by=c("day", "organization")][!is.na(organization)][order(-day, -number_of_patents)] %>%
  head(n=10)
```
## Innovation in Tech:
What is the most innovative tech sector? For the top 10 companies (worldwide) with the most patents, what are the top 5 USPTO tech main classes?


### Most Innovative Sector
```{r}
combined_data_for_q3 <- merge(x=combined_data_for_q1, y=uspc_tbl, by= c("patent_id"))

combined_data_for_q3 [,  .(number_of_patents=.N), by="mainclass_id"][order(-number_of_patents)] %>% 
  head(n=10)

```

 
### Top 5 tech main classes among top 10 companies (worldwide) with most patents
```{r}
companies <- combined_data_for_q3[, .(number_of_patents=.N), by=organization][order(-number_of_patents)][1:10, organization]

combined_data_for_q3[organization %in% companies, .(freq_of_mainclass=.N), by = mainclass_id][order(-freq_of_mainclass)][1:5]
```
